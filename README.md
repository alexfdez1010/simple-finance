# üí∞ Simple Finance

A **modern, production-ready portfolio tracking application** built with Next.js 15, React 19, TypeScript, and Prisma. Track your financial products with real-time Yahoo Finance data or custom fixed-return investments, all displayed in EUR.

Built following **SOLID principles** and enterprise-level best practices with comprehensive test coverage.

[![Next.js](https://img.shields.io/badge/Next.js-15.5.4-black)](https://nextjs.org/)
[![React](https://img.shields.io/badge/React-19.1.0-blue)](https://react.dev/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-blue)](https://www.typescriptlang.org/)
[![TailwindCSS](https://img.shields.io/badge/TailwindCSS-4.x-38bdf8)](https://tailwindcss.com/)
[![Prisma](https://img.shields.io/badge/Prisma-6.7.0-2D3748)](https://www.prisma.io/)
[![Tests](https://img.shields.io/badge/Tests-27%20E2E%20%2B%2021%20Unit-success)](https://playwright.dev/)

## üéØ Features

### üìä Dual Product Types

**Yahoo Finance Products**

- Track real stocks, ETFs, and cryptocurrencies using live Yahoo Finance API
- Automatic USD to EUR conversion with real-time exchange rates
- Purchase price and date tracking for accurate ROI calculations
- Auto-fill current market price when adding products

**Custom Products**

- Track investments with fixed annual return rates
- Daily compound interest calculation: `A = P(1 + r/365)^days`
- Direct EUR input for initial investment
- Perfect for savings accounts, bonds, or fixed-return investments

### üíº Portfolio Management

- **Real-time Tracking** - Server-side rendering with 60-second cache revalidation
- **EUR Currency** - All values displayed in euros (‚Ç¨)
- **Portfolio Statistics** - Total value, total return, return percentage
- **Sorted Display** - Products ordered by total current value
- **Flexible Quantities** - Support for fractional shares (e.g., 2.5 shares)
- **Responsive UI** - Beautiful dark mode support with TailwindCSS 4

### üîê Password Protection

- **Single-Password Authentication** - Simple password-based access control
- **Cookie-Based Sessions** - Secure HttpOnly cookies with 365-day expiration
- **SHA-256 Token Hashing** - Secure token generation and validation
- **Route Protection** - All routes protected except auth page
- **Smart Redirects** - Preserves intended destination after login
- **Environment-Based** - Password stored in `PASSWORD` environment variable

### üèóÔ∏è Technical Excellence

- **SOLID Principles** - Applied rigorously across all code (SRP, OCP, LSP, ISP, DIP)
- **Type Safety** - Full TypeScript strict mode with Prisma-generated types
- **Clean Architecture** - Domain, infrastructure, and presentation layers
- **Server Actions** - Modern Next.js 15 data mutations with automatic revalidation
- **Comprehensive Testing** - 27 E2E tests + 21 unit tests (100% passing)
- **TSDoc Documentation** - All functions documented with purpose, params, and returns
- **Code Quality** - ESLint + Prettier with pre-commit hooks
- **File Size Limit** - Max 200 lines per file (enforced)

## üõ†Ô∏è Tech Stack

### Frontend

- **[Next.js 15.5.4](https://nextjs.org/docs)** - React framework with App Router and Server Components
- **[React 19.1.0](https://react.dev/)** - Latest React with concurrent features
- **[TypeScript 5.x](https://www.typescriptlang.org/)** - Strict type safety throughout
- **[TailwindCSS 4.x](https://tailwindcss.com/)** - Utility-first CSS with dark mode
- **[Lucide React](https://lucide.dev/)** - Beautiful icon library
- **[shadcn/ui](https://ui.shadcn.com/)** - High-quality React components (ready to integrate)

### Backend & Data

- **[Prisma 6.7.0](https://www.prisma.io/)** - Type-safe ORM with PostgreSQL
- **[PostgreSQL](https://www.postgresql.org/)** - Production-ready relational database
- **[Yahoo Finance2](https://www.npmjs.com/package/yahoo-finance2)** - Real-time financial data
- **[Zod 4.x](https://zod.dev/)** - Runtime schema validation
- **[date-fns](https://date-fns.org/)** - Modern date manipulation

### Testing

- **[Playwright](https://playwright.dev/)** - E2E testing with automatic database cleanup
- **[Vitest](https://vitest.dev/)** - Fast unit testing with JSDOM
- **[Testing Library](https://testing-library.com/)** - React component testing utilities
- **Docker Compose** - Isolated test database environment

### DevOps & Tools

- **[Docker](https://www.docker.com/)** - Containerized PostgreSQL for development
- **[ESLint](https://eslint.org/)** - Code linting with Next.js config
- **[Prettier](https://prettier.io/)** - Automatic code formatting
- **[Turbopack](https://turbo.build/pack)** - Fast development builds

## üìã Prerequisites

Before you begin, ensure you have the following installed:

- **[Node.js](https://nodejs.org/)** 20.x or higher
- **[npm](https://www.npmjs.com/)** 10.x or higher
- **[Docker Desktop](https://www.docker.com/products/docker-desktop/)** (for PostgreSQL database)
- **[Git](https://git-scm.com/)** for version control

## üöÄ Quick Start

### 1. Clone the Repository

```bash
git clone https://github.com/alexfdez1010/simple-finance.git
cd simple-finance
```

### 2. Install Dependencies

```bash
npm install
```

This will install all required packages including Next.js, React, Prisma, and testing tools.

### 3. Set Up Environment Variables

```bash
cp .env.example .env
```

The default configuration works out of the box:

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/db"
PASSWORD="12345678"
```

**Note:** Change the `PASSWORD` to your desired access password. This protects all routes from unauthorized access.

### 4. Start the Database

```bash
npm run database
```

This starts a PostgreSQL container using Docker Compose. The database will be available at `localhost:5432`.

### 5. Run Database Migrations

Open a new terminal and run:

```bash
npm run database:dev
```

This creates the database schema and generates the Prisma client.

### 6. Start the Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser. You'll be prompted to enter the password (default: `12345678`). After authentication, you'll see the Simple Finance dashboard!

### 7. Stop the Database (when done)

```bash
npm run database:down
```

## üé¨ Usage

### Authentication

When you first visit the application, you'll be redirected to the password page:

1. Enter the password (default: `12345678`)
2. Click **"Continue"**
3. You'll be authenticated and redirected to the dashboard
4. Your session is stored in a secure cookie for 30 days
5. To logout, clear your browser cookies

The password is stored in the `PASSWORD` environment variable for security.

### Adding a Yahoo Finance Product

1. Click **"Add Yahoo Finance Product"** on the dashboard
2. Enter a stock symbol (e.g., `AAPL`, `MSFT`, `GOOGL`)
3. The system validates the symbol and auto-fills the current price
4. Enter quantity and adjust purchase price/date if needed
5. Click **"Add Product"** - values are automatically converted to EUR

### Adding a Custom Product

1. Click **"Add Custom Product"** on the dashboard
2. Enter product name (e.g., "Savings Account")
3. Enter initial investment in EUR (e.g., `1000`)
4. Enter annual return rate as percentage (e.g., `5.5` for 5.5%)
5. Select investment date
6. Enter quantity (usually `1` for custom products)
7. Click **"Add Product"** - compound interest is calculated daily

### Viewing Portfolio Statistics

The dashboard displays:

- **Total Portfolio Value** - Sum of all products in EUR
- **Total Return** - Absolute gain/loss in EUR
- **Return %** - Percentage return on total investment
- **Individual Products** - Sorted by total current value (highest first)

Each product card shows:

- Current value per unit
- Total value (current value √ó quantity)
- Return amount and percentage
- Purchase/investment date

## üìú Available Scripts

### Development Commands

| Command          | Description                                                    |
| ---------------- | -------------------------------------------------------------- |
| `npm run dev`    | Start development server with Turbopack (auto-starts database) |
| `npm run build`  | Build optimized production bundle                              |
| `npm run start`  | Start production server                                        |
| `npm run launch` | Build and start with database                                  |

### Testing Commands

| Command                    | Description                                          |
| -------------------------- | ---------------------------------------------------- |
| `npm test`                 | Run all tests (unit + integration + E2E)             |
| `npm run test:unit`        | Run unit tests with Vitest                           |
| `npm run test:integration` | Run integration tests                                |
| `npm run test:e2e`         | Run E2E tests with Playwright (auto-manages test DB) |
| `npm run playwright`       | Open Playwright UI for debugging tests               |

### Database Commands

| Command                   | Description                             |
| ------------------------- | --------------------------------------- |
| `npm run database`        | Start PostgreSQL container              |
| `npm run database:down`   | Stop and remove database container      |
| `npm run database:dev`    | Create and run migrations (development) |
| `npm run database:deploy` | Deploy migrations (production)          |
| `npm run database:studio` | Open Prisma Studio (database GUI)       |
| `npm run database:create` | Generate Prisma client and push schema  |

### Code Quality Commands

| Command               | Description                          |
| --------------------- | ------------------------------------ |
| `npm run lint`        | Run ESLint and Prisma format check   |
| `npm run format`      | Format all code with Prettier        |
| `npm run lint-format` | Lint and format (run before commits) |
| `npm run pre-commit`  | Run all tests + lint + format        |

## üèóÔ∏è Project Structure

```
simple-finance/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                      # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                 # Authentication page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/            # Dashboard page (Server Component)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add/              # Add Yahoo Finance product
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ add-custom/       # Add custom product
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx            # Root layout with AuthGuard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # Home page (redirects to dashboard)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css           # Global styles
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/               # React components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth-guard.tsx          # Route protection component
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard-client.tsx    # Client component for interactivity
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ portfolio-stats.tsx     # Portfolio statistics display
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ product-card.tsx        # Individual product card
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ lib/                      # Business logic and utilities
‚îÇ       ‚îú‚îÄ‚îÄ actions/              # Next.js Server Actions
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ auth-actions.ts         # Authentication actions
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ product-actions.ts      # CRUD operations
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ auth/                 # Authentication utilities
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ auth-utils.ts           # Token generation, validation
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ domain/               # Domain layer (business logic)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.types.ts    # TypeScript interfaces
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ custom-product-calculator.ts  # Compound interest
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ currency-converter.ts         # USD to EUR conversion
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ portfolio-statistics.ts       # Portfolio calculations
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ infrastructure/       # Infrastructure layer
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product-repository.ts   # Prisma database access
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ yahoo-finance/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server-client.ts        # Yahoo Finance API client
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ currency/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ exchange-rate-client.ts # Exchange rate API
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ hooks/                # React hooks
‚îÇ           ‚îî‚îÄ‚îÄ useYahooFinance.ts        # Client-side Yahoo Finance hook
‚îÇ
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma             # Database schema
‚îÇ   ‚îî‚îÄ‚îÄ migrations/               # Database migrations
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ e2e/                      # Playwright E2E tests
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.spec.ts                 # Auth tests (10 tests)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth-helper.ts               # Authentication helper
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add-yahoo-product.spec.ts    # Yahoo product tests (7 tests)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add-custom-product.spec.ts   # Custom product tests (10 tests)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ global-setup.ts              # Test database cleanup
‚îÇ   ‚îú‚îÄ‚îÄ unit/                     # Vitest unit tests
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ currency-converter.test.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ custom-product-calculator-eur.test.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useYahooFinance.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ setup.ts                  # Test configuration
‚îÇ
‚îú‚îÄ‚îÄ generated/                    # Generated Prisma client
‚îÇ   ‚îî‚îÄ‚îÄ prisma/
‚îÇ
‚îú‚îÄ‚îÄ .env.example                  # Environment variables template
‚îú‚îÄ‚îÄ compose.yml                   # Docker Compose for PostgreSQL
‚îú‚îÄ‚îÄ compose-test.yml              # Docker Compose for test database
‚îú‚îÄ‚îÄ middleware.ts                 # Next.js middleware for auth
‚îú‚îÄ‚îÄ package.json                  # Dependencies and scripts
‚îú‚îÄ‚îÄ tsconfig.json                 # TypeScript configuration
‚îú‚îÄ‚îÄ eslint.config.mjs             # ESLint configuration
‚îú‚îÄ‚îÄ vitest.config.ts              # Vitest configuration
‚îú‚îÄ‚îÄ playwright.config.ts          # Playwright configuration
‚îî‚îÄ‚îÄ AGENTS.md                     # Development guidelines (SOLID principles)
```

## üß™ Testing

This project has **comprehensive test coverage** with 38+ tests across unit and E2E testing.

### Unit Tests (21 tests)

Located in `tests/unit/`, these test business logic in isolation:

- **`currency-converter.test.ts`** (10 tests) - USD to EUR conversion, exchange rates, fallbacks
- **`custom-product-calculator-eur.test.ts`** (11 tests) - Compound interest calculations, edge cases
- **`useYahooFinance.test.ts`** - React hook for Yahoo Finance API

```bash
npm run test:unit
```

**Technologies:** Vitest, JSDOM, Testing Library

### End-to-End Tests (27 tests)

Located in `tests/e2e/`, these test complete user workflows:

**Authentication Tests** (`auth.spec.ts` - 10 tests)

- ‚úÖ Redirect unauthenticated users to auth page
- ‚úÖ Invalid password error handling
- ‚úÖ Empty password validation
- ‚úÖ Successful authentication and redirect
- ‚úÖ Default redirect behavior
- ‚úÖ Auth persistence across navigation
- ‚úÖ Auth persistence after page reload
- ‚úÖ Route protection verification
- ‚úÖ Auth page accessibility
- ‚úÖ Cookie attributes validation

**Yahoo Finance Product Tests** (`add-yahoo-product.spec.ts` - 7 tests)

- ‚úÖ Main flow: Create product with AAPL symbol
- ‚úÖ Symbol validation and error handling
- ‚úÖ Form validation (required fields)
- ‚úÖ Navigation (cancel, back link)
- ‚úÖ Lowercase symbol handling
- ‚úÖ Auto-fill functionality

**Custom Product Tests** (`add-custom-product.spec.ts` - 10 tests)

- ‚úÖ Main flow: Create custom product with 5.5% return
- ‚úÖ High return rate test (15.75%)
- ‚úÖ Fractional quantity support (2.5)
- ‚úÖ Form validation
- ‚úÖ Navigation tests
- ‚úÖ Info box and helper text verification
- ‚úÖ Minimum value validation

```bash
npm run test:e2e
```

**Technologies:** Playwright, Chromium

### Test Database

E2E tests use an isolated test database that is automatically:

- Created before tests run
- Cleaned between test runs (via `global-setup.ts`)
- Destroyed after tests complete

### Running All Tests

```bash
npm run test
```

This runs unit tests, integration tests, and E2E tests sequentially.

## üóÑÔ∏è Database Schema

### Models

The database uses a **polymorphic design** with Prisma and PostgreSQL:

**FinancialProduct** (Base table)

- `id` - Unique identifier (CUID)
- `type` - Product type enum (`YAHOO_FINANCE` | `CUSTOM`)
- `name` - Product name
- `quantity` - Float (supports fractional shares)
- `createdAt`, `updatedAt` - Timestamps

**YahooFinanceData** (1:1 with FinancialProduct)

- `symbol` - Stock symbol (e.g., "AAPL")
- `purchasePrice` - Purchase price per share in EUR
- `purchaseDate` - Date of purchase

**CustomProductData** (1:1 with FinancialProduct)

- `annualReturnRate` - Annual return rate as decimal (e.g., 0.055 for 5.5%)
- `initialInvestment` - Initial investment in EUR
- `investmentDate` - Date of investment

**ProductSnapshot** (1:N with FinancialProduct)

- `date` - Snapshot date
- `value` - Value at that date
- `quantity` - Quantity at that date
- Used for historical tracking (future feature)

### Compound Interest Formula

Custom products calculate daily compound interest:

```
A = P √ó (1 + r/365)^days

Where:
- A = Current value (EUR)
- P = Initial investment (EUR)
- r = Annual return rate (decimal, e.g., 0.055 for 5.5%)
- days = Days since investment date
```

**Example:** ‚Ç¨1,000 invested at 5.5% annual rate for 365 days:

```
A = 1000 √ó (1 + 0.055/365)^365 = ‚Ç¨1,056.54
```

### Database Migrations

```bash
# Create a new migration after schema changes
npm run database:dev

# View database in GUI
npm run database:studio
```

## üèõÔ∏è Architecture

This project follows **Clean Architecture** principles with clear separation of concerns:

### Layers

**Presentation Layer** (`src/app/`, `src/components/`)

- Next.js App Router pages (Server Components)
- React client components for interactivity
- Server Actions for data mutations

**Domain Layer** (`src/lib/domain/`)

- Business logic (compound interest, portfolio statistics)
- Type definitions and interfaces
- Pure functions, no external dependencies

**Infrastructure Layer** (`src/lib/infrastructure/`)

- Database access (Prisma repositories)
- External APIs (Yahoo Finance, exchange rates)
- Caching and data fetching

### Key Design Patterns

- **Repository Pattern** - Database access abstraction
- **Service Layer** - Business logic encapsulation
- **Dependency Inversion** - Domain doesn't depend on infrastructure
- **Server Actions** - Modern Next.js data mutations
- **Server Components** - Server-side rendering with data fetching

## üöÄ Deployment

### Environment Variables

Required environment variables:

```env
DATABASE_URL="postgresql://user:password@host:5432/database"
```

### Production Build

```bash
# Build optimized bundle
npm run build

# Start production server
npm run start
```

### Authentication Setup

For production deployment, ensure the `PASSWORD` environment variable is set securely:

```env
PASSWORD="your-secure-password-here"
```

**Security Best Practices:**

- Use a strong, unique password (minimum 12 characters recommended)
- Store in environment variables, never in code
- Use your platform's secrets management (Vercel Secrets, Railway Variables, etc.)
- Change password periodically
- Use HTTPS in production (enforced by secure cookie flag)

### Deployment Platforms

This application can be deployed to:

- **[Vercel](https://vercel.com/)** - Recommended (built by Next.js creators)
- **[Railway](https://railway.app/)** - Easy PostgreSQL + Node.js hosting
- **[Fly.io](https://fly.io/)** - Docker-based deployment
- **[AWS](https://aws.amazon.com/)** / **[GCP](https://cloud.google.com/)** - Enterprise solutions

### Database Hosting

For production PostgreSQL:

- **[Vercel Postgres](https://vercel.com/storage/postgres)** - Serverless PostgreSQL
- **[Supabase](https://supabase.com/)** - Open-source Firebase alternative
- **[Neon](https://neon.tech/)** - Serverless PostgreSQL
- **[Railway](https://railway.app/)** - Simple PostgreSQL hosting

## ü§ù Contributing

Contributions are welcome! Please follow these guidelines:

### Development Standards

1. **Read [AGENTS.md](./AGENTS.md)** - Complete development guidelines
2. **SOLID Principles** - Apply SRP, OCP, LSP, ISP, DIP
3. **File Size Limit** - Max 200 lines per file
4. **Documentation** - TSDoc comments on all functions
5. **Testing** - Add tests for new features
6. **Code Quality** - Run `npm run lint-format` before committing

### Workflow

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make your changes
4. Run tests (`npm test`)
5. Run linting (`npm run lint-format`)
6. Commit your changes (`git commit -m 'Add amazing feature'`)
7. Push to the branch (`git push origin feature/amazing-feature`)
8. Open a Pull Request

## üìö Resources

- **[Next.js Documentation](https://nextjs.org/docs)** - Framework documentation
- **[React Documentation](https://react.dev/)** - React 19 features
- **[Prisma Documentation](https://www.prisma.io/docs)** - Database ORM
- **[TailwindCSS Documentation](https://tailwindcss.com/docs)** - Styling
- **[Playwright Documentation](https://playwright.dev/)** - E2E testing
- **[Vitest Documentation](https://vitest.dev/)** - Unit testing

## üìÑ License

This project is open source and available under the [MIT License](LICENSE).

## üë§ Author

**Alejandro Fern√°ndez**

- GitHub: [@alexfdez1010](https://github.com/alexfdez1010)

## üôè Acknowledgments

- Built following enterprise best practices
- Inspired by modern financial tracking applications
- Uses best-in-class open source technologies

---

**‚≠ê If you find this project useful, please consider giving it a star on GitHub!**
